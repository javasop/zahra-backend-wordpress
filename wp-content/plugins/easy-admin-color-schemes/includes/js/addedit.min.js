/*
Easy Admin Color Schemes <http://JamesDimick.com/easy-admin-color-schemes>
Created by James Dimick <http://JamesDimick.com>

  Copyright (C) 2011 James Dimick <mail@jamesdimick.com> - JamesDimick.com

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

var eacs;jQuery(function(a){eacs=new function(){this.css=new function(){this.input=a("#content");this.label=this.input.prev()};this.preview=new function(){this.frame=a('<iframe id="schemepreview" src="'+eacsL10n.adminBaseUrl+'"/>').insertAfter("#previewjsnote").prev().remove().prevObject;this.colorsCss=this.previewCss=this.timer=undefined;this.update=function(){}};this.colors=new function(){this.inputs=new function(){this.all=a("#eacs-primarycolors input");this.one=this.all.filter("#priclr1");this.two=this.all.filter("#priclr2");this.three=this.all.filter("#priclr3");this.four=this.all.filter("#priclr4")};this.picker=a('<div id="colorPickerDiv" style="display:none"/>').insertAfter("#eacs-primarycolors p:first-of-type");this.shortcodeRegex=/\[primarycolor([1-4])\]/gi;this.hexColorRegex=/^#[a-f0-9]{6}$/i;this.blank="#ffffff";this.farbtastic=a.farbtastic(this.picker);this.origFarbUpdDispFunc=this.farbtastic.updateDisplay;this.timer=undefined}};eacs.preview.update=function(){try{var c=a(this).contents().get(0).location,b=a("head",a(this).contents());eacs.preview.colorsCss=a("#colors-css",b);eacs.preview.previewCss=a("#eacs-previewstyles",b);if("href" in c&&c.href.search(new RegExp("^"+eacsL10n.adminBaseUrl,"i"))!=-1){var g=a.trim(eacs.css.input.val());if(g.length>0){if(g.search(eacs.colors.shortcodeRegex)!=-1){var d=function(e){e=a.trim(e);return e.search(eacs.colors.hexColorRegex)!=-1?e:eacs.colors.blank},h=[d(eacs.colors.inputs.one.val()),d(eacs.colors.inputs.two.val()),d(eacs.colors.inputs.three.val()),d(eacs.colors.inputs.four.val())];g=g.replace(eacs.colors.shortcodeRegex,function(e,i){return h[i-1]})}if(eacs.preview.colorsCss.length>0){eacs.preview.colorsCss.prop("disabled",true)}if(eacs.preview.previewCss.length>0){eacs.preview.previewCss.prop("disabled",false);if(eacs.preview.previewCss.html()!=g){eacs.preview.previewCss.html(g)}}else{a("head",a(this).contents()).append('<style type="text/css" id="eacs-previewstyles">'+g+"</style>")}}else{if(eacs.preview.colorsCss.length>0){eacs.preview.colorsCss.prop("disabled",false)}if(eacs.preview.previewCss.length>0){eacs.preview.previewCss.prop("disabled",true)}}}}catch(f){}};eacs.css.input.bind("input keydown",function(){clearTimeout(eacs.preview.timer);eacs.preview.timer=setTimeout(function(){eacs.preview.update.call(eacs.preview.frame)},300)}).focus(function(){eacs.css.label.css("visibility","hidden")}).blur(function(){if(this.value.length<=0){eacs.css.label.css("visibility","")}}).droppable({accept:"#eacs-primarycolors #shortcodes code",drop:function(c,b){a(this).insertAtCaret(b.draggable.text()).trigger("keydown")}});eacs.css.label.css("visibility",eacs.css.input.val().length<=0?"":"hidden").click(function(){a(this).css("visibility","hidden");eacs.css.input.focus()});eacs.preview.frame.load(eacs.preview.update);eacs.colors.farbtastic.updateDisplay=function(){var b=eacs.colors.farbtastic.callback.get(0);eacs.colors.origFarbUpdDispFunc.call(b);if(b.value.search(eacs.colors.hexColorRegex)!=-1&&eacs.css.input.val().search(eacs.colors.shortcodeRegex)!=-1){eacs.preview.update.call(eacs.preview.frame)}};eacs.colors.inputs.all.each(function(){eacs.colors.farbtastic.linkTo(this)}).focus(function(){eacs.colors.farbtastic.linkTo(this);clearTimeout(eacs.colors.timer);eacs.colors.picker.filter(":hidden").animate({opacity:"show",height:"show"},"slow")}).blur(function(){eacs.colors.timer=setTimeout(function(){eacs.colors.picker.filter(":visible").animate({opacity:"hide",height:"hide"},"slow")},50)});a("#eacs-primarycolors #shortcodes code").css("cursor","pointer").attr("title",eacsL10n.insertShortcodeTitle).draggable({helper:"clone"}).click(function(){eacs.css.input.insertAtCaret(a(this).text());eacs.preview.update.call(eacs.preview.frame)})});(function(a){a.fn.insertAtCaret=function(b){return this.each(function(){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=b;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var e=this.selectionStart;var d=this.selectionEnd;var f=this.scrollTop;this.value=this.value.substring(0,e)+b+this.value.substring(d,this.value.length);this.focus();this.selectionStart=e+b.length;this.selectionEnd=e+b.length;this.scrollTop=f}else{this.value+=b;this.focus()}}})}})(jQuery);